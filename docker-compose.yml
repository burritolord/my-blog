version: '3.5'

services:
 ghost_db:
  image: mysql:5.7
  container_name: mysql
  volumes:
    - ./mysql/data:/var/lib/mysql
  env_file:
    .env

 ghost:
  build: ./ghost
  container_name: ghost
  volumes:
    - ./ghost/content:/var/lib/ghost/content
  ports:
    - 80:2368
  environment:
    NODE_ENV: development
    database__client: mysql
    database__connection__host: ghost_db
    database__connection__user: ${MYSQL_USER}
    database__connection__password: ${MYSQL_PASSWORD}
    database__connection__database: ${MYSQL_DATABASE}
  depends_on:
    - ghost_db
  entrypoint: ["wait-for-it.sh", "mysql", "--", "docker-entrypoint.sh"]
  command: ["node", "current/index.js"]